<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Statystyki Opisowe - Filip Liebersbach</title>
    
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="icon" href="images/logo.png" type="image/x-icon">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <style>
        #squares-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; background-color: #111; pointer-events: none;
        }
        /* Odblokowany scroll dla tej podstrony */
        body { background: transparent; overflow-y: auto; }

        /* --- UKŁAD --- */
        .stats-wrapper {
            display: flex;
            gap: 30px;
            width: 100%;
            align-items: flex-start;
        }

        .left-column {
            flex: 1;
            min-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .right-column {
            flex: 2;
            min-width: 450px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Kontenery wewnętrzne */
        .glass-container-inner {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            color: #ddd;
        }

        /* --- POPRAWIONA CZYTELNOŚĆ TABELI --- */
        #dataTableContainer {
            overflow-y: auto;
            margin-top: 15px;
            border-radius: 10px;
            /* Ciemne tło pod tabelą dla kontrastu */
            background: rgba(0, 0, 0, 0.4); 
            border: 1px solid rgba(255,255,255,0.15);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #fff; /* Biały tekst */
        }

        th, td {
            padding: 10px 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            font-size: 0.9rem;
        }

        th {
            /* Ciemny, solidny nagłówek */
            background: #1a1a1a; 
            color: #fff;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: 600;
        }

        /* Komórki do edycji - wyraźnie zaznaczone */
        td[contenteditable="true"] {
            background: rgba(255, 255, 255, 0.1);
            cursor: text;
            transition: background 0.2s;
        }
        td[contenteditable="true"]:focus {
            background: rgba(255, 255, 255, 0.25);
            outline: 2px solid #8ecae6;
            color: #fff;
        }
        td[contenteditable="true"]:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Select w nagłówku */
        th select {
            margin-top: 5px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 4px;
            width: 95%;
            font-size: 0.85rem;
        }

        /* --- POPRAWIONA CZYTELNOŚĆ WYKRESÓW --- */
        .chart-box {
            /* Jasne tło (prawie białe), żeby wykresy były czytelne */
            background: rgba(255, 255, 255, 0.95); 
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            color: #333; /* Ciemny tekst wewnątrz boxa wykresu */
            min-height: 300px;
        }

        h1, h2, h3 { color: #fff; text-align: center; margin-top: 0; }
        p { color: #ccc; font-size: 0.95rem; }

        /* Tabele wyników (prawa kolumna) */
        #summaryResultsTable {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        #summaryResultsTable th { background: #252525; }
        
        /* Mobile RWD */
        @media (max-width: 1000px) {
            .stats-wrapper { flex-direction: column; }
            .left-column, .right-column { width: 100%; }
        }
    </style>
</head>
<body>
    <canvas id="squares-canvas"></canvas>

    <header>
        <div class="pill-nav-container">
            <nav class="pill-nav">
                <a href="index.html" class="pill-logo glass-effect">
                    <img src="images/logo.png" alt="Logo" />
                </a>
                <div class="pill-nav-items">
                    <ul class="pill-list">
                        <li><a href="doswiadczenie.html" class="pill glass-effect"><span class="hover-circle"></span><span class="label-stack"><span class="pill-label">Doświadczenie</span><span class="pill-label-hover">Doświadczenie</span></span></a></li>
                        <li><a href="projekty.html" class="pill glass-effect"><span class="hover-circle"></span><span class="label-stack"><span class="pill-label">Projekty</span><span class="pill-label-hover">Projekty</span></span></a></li>
                        <li><a href="publikacje.html" class="pill glass-effect"><span class="hover-circle"></span><span class="label-stack"><span class="pill-label">Publikacje</span><span class="pill-label-hover">Publikacje</span></span></a></li>
                        <li><a href="rekomendacje.html" class="pill glass-effect"><span class="hover-circle"></span><span class="label-stack"><span class="pill-label">Rekomendacje</span><span class="pill-label-hover">Rekomendacje</span></span></a></li>
                        <li><a href="statystyka.html" class="pill glass-effect is-active"><span class="hover-circle"></span><span class="label-stack"><span class="pill-label">Statystyka</span><span class="pill-label-hover">Statystyka</span></span></a></li>
                    </ul>
                </div>
                <button class="mobile-menu-button glass-effect"><span class="hamburger-line"></span><span class="hamburger-line"></span></button>
                <div class="mobile-menu-popover">
                    <ul class="mobile-menu-list">
                        <li><a href="doswiadczenie.html" class="mobile-menu-link">Doświadczenie</a></li>
                        <li><a href="projekty.html" class="mobile-menu-link">Projekty</a></li>
                        <li><a href="publikacje.html" class="mobile-menu-link">Publikacje</a></li>
                        <li><a href="rekomendacje.html" class="mobile-menu-link">Rekomendacje</a></li>
                        <li><a href="statystyka.html" class="mobile-menu-link">Statystyka</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <main class="intro" style="height: auto; min-height: 100vh; padding-bottom: 40px;">
        
        <div class="main_content glass-effect" style="flex-direction: column; width: 95%; max-width: 1400px; height: auto; max-height: none;">
            
            <div class="content-header">
                <h1>Analizator Danych Statystycznych</h1>
                <p>Edytuj dane bezpośrednio w tabeli. Statystyki i wykresy będą automatycznie aktualizowane.</p>
            </div>

            <div class="stats-wrapper">
                
                <div class="left-column glass-container-inner">
                    <h3>Dane wejściowe</h3>
                    <p style="font-size: 0.85rem; text-align: center;">Kliknij w komórkę, aby edytować wartość.</p>
                    
                    <div id="dataTableContainer">
                        <table id="dataTable">
                            <thead>
                                <tr id="columnHeaders"></tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="right-column glass-container-inner">
                    <h3>Statystyki Opisowe</h3>
                    
                    <div style="overflow-x: auto; margin-bottom: 20px;">
                        <table id="summaryResultsTable">
                            <thead>
                                <tr>
                                    <th>Zmienna</th><th>Typ</th><th>N</th><th>M</th><th>Me</th><th>SD</th><th>Sk.</th><th>Kurt.</th><th>Min.</th><th>Maks.</th>
                                </tr>
                            </thead>
                            <tbody id="summaryResultsBody"></tbody>
                        </table>
                    </div>
                    <p class="error-message" id="generalDataError" style="color: #ff6b6b; font-weight: bold; text-align: center;"></p>

                    <div id="frequencyTables">
                        <h3>Tabele Częstości</h3>
                    </div>

                    <div id="chartsSection">
                        <h3>Wizualizacja Danych</h3>
                        <div id="chartsContainer"></div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer style="width: 100%; padding: 15px; background: transparent;">
        <div class="footer-content">
            <div class="social-icons">
                <a href="https://www.youtube.com/@lieberfilip" target="_blank"><i class="fa-brands fa-youtube" style="color:white; font-size: 20px;"></i></a>
                <a href="https://www.linkedin.com/in/liebersbach-filip/" target="_blank"><i class="fab fa-linkedin" style="color:white; font-size: 20px;"></i></a>
                <a href="https://www.researchgate.net/profile/Filip-Liebersbach-2?ev=hdr_xprf" target="_blank"><i class="fa-brands fa-researchgate" style="color:white; font-size: 20px;"></i></a>
            </div>
            <div class="contact-info" style="font-size: 0.7em;">
                <a href="mailto:kontakt@lieberfilip.pl" style="color: white; text-decoration: underline;">kontakt@lieberfilip.pl</a>
            </div>
        </div>
        <div class="copyright" style="font-size: 0.6em;">&copy; 2025 Filip Liebersbach.</div>
    </footer>

    <script src="background.js"></script>
    <script src="nav.js"></script>

    <script>
        // --- Konfiguracja Tabeli ---
        const NUM_COLUMNS = 2; 
        const NUM_ROWS = 40; 
        let columnTypes = ['nominal', 'ordinal']; 

        const typeLabels = {
            'nominal': 'nominalna',
            'ordinal': 'porządkowa',
            'interval': 'interwałowa',
            'ratio': 'ilorazowa'
        };

        const dataTableBody = document.getElementById('tableBody');
        const columnHeadersRow = document.getElementById('columnHeaders');
        const summaryResultsBody = document.getElementById('summaryResultsBody');
        const frequencyTablesDiv = document.getElementById('frequencyTables');
        const generalDataErrorP = document.getElementById('generalDataError');
        const chartsContainer = document.getElementById('chartsContainer'); 

        let charts = [];

        // --- Funkcje statystyczne ---
        function sum(arr) { return arr.reduce((a, b) => a + b, 0); }
        function mean(arr) { return arr.length === 0 ? NaN : sum(arr) / arr.length; }
        
        function median(arr) {
            if (arr.length === 0) return NaN;
            const isNumeric = typeof arr[0] === 'number' && !isNaN(arr[0]);
            const sortedArr = [...arr].sort((a, b) => {
                const ordinalOrder = { 'Zdecydowanie tak': 4, 'Tak': 3, 'Nie': 2, 'Zdecydowanie nie': 1 };
                if (!isNumeric) {
                    if (ordinalOrder[a] !== undefined && ordinalOrder[b] !== undefined) return ordinalOrder[a] - ordinalOrder[b];
                    return String(a).localeCompare(String(b)); 
                }
                return a - b;
            });
            const mid = Math.floor(sortedArr.length / 2);
            return (sortedArr.length % 2 === 0 && isNumeric) ? (sortedArr[mid - 1] + sortedArr[mid]) / 2 : sortedArr[mid];
        }

        function variance(arr) {
            if (arr.length < 2) return NaN;
            const m = mean(arr);
            return sum(arr.map(x => Math.pow(x - m, 2))) / (arr.length - 1);
        }
        function stdDev(arr) { return Math.sqrt(variance(arr)); }

        function skewness(arr) {
            if (arr.length < 3) return NaN;
            const m = mean(arr);
            const s = stdDev(arr);
            if (s === 0) return 0;
            const n = arr.length;
            const sumCubes = sum(arr.map(x => Math.pow((x - m) / s, 3)));
            return (n / ((n - 1) * (n - 2))) * sumCubes;
        }

        function kurtosis(arr) {
            if (arr.length < 4) return NaN;
            const m = mean(arr);
            const s = stdDev(arr);
            if (s === 0) return 0;
            const n = arr.length;
            const sumQuads = sum(arr.map(x => Math.pow((x - m) / s, 4)));
            return ((n * (n + 1)) / ((n - 1) * (n - 2) * (n - 3))) * sumQuads - (3 * Math.pow(n - 1, 2)) / ((n - 2) * (n - 3));
        }

        // --- Generowanie danych ---
        function generateRandomData(type) {
            if (type === 'interval') return (Math.random() * 80 + 20).toFixed(0); 
            if (type === 'ratio') return (Math.random() * 150).toFixed(0); 
            if (type === 'ordinal') {
                const categories = ['Zdecydowanie tak', 'Tak', 'Nie', 'Zdecydowanie nie']; 
                return categories[Math.floor(Math.random() * categories.length)];
            }
            const categories = ['Mężczyzna', 'Kobieta'];
            return categories[Math.floor(Math.random() * categories.length)];
        }

        function initializeTable() {
            columnHeadersRow.innerHTML = '';
            columnTypes.forEach((type, colIndex) => {
                const th = document.createElement('th');
                th.innerHTML = `Kolumna ${colIndex + 1}
                    <select data-col-index="${colIndex}" onchange="changeColumnType(this)">
                        <option value="nominal" ${type === 'nominal' ? 'selected' : ''}>nominalna</option>
                        <option value="ordinal" ${type === 'ordinal' ? 'selected' : ''}>porządkowa</option>
                        <option value="interval" ${type === 'interval' ? 'selected' : ''}>interwałowa</option>
                        <option value="ratio" ${type === 'ratio' ? 'selected' : ''}>ilorazowa</option>
                    </select>`;
                columnHeadersRow.appendChild(th);
            });

            dataTableBody.innerHTML = '';
            for (let r = 0; r < NUM_ROWS; r++) {
                const row = document.createElement('tr');
                for (let c = 0; c < NUM_COLUMNS; c++) { 
                    const cell = document.createElement('td');
                    cell.contentEditable = true;
                    cell.textContent = generateRandomData(columnTypes[c]); 
                    row.appendChild(cell);
                }
                dataTableBody.appendChild(row);
            }
            dataTableBody.addEventListener('input', debounce(calculateAllStats, 300));
        }

        function changeColumnType(selectElement) {
            const colIndex = parseInt(selectElement.dataset.colIndex);
            columnTypes[colIndex] = selectElement.value;
            const rows = dataTableBody.children;
            for (let r = 0; r < rows.length; r++) {
                rows[r].children[colIndex].textContent = generateRandomData(columnTypes[colIndex]);
            }
            calculateAllStats();
        }

        function parseTableData() {
            const data = Array.from({ length: NUM_COLUMNS }, () => []);
            const rows = dataTableBody.children;
            for (let r = 0; r < rows.length; r++) {
                const cells = rows[r].children;
                for (let c = 0; c < NUM_COLUMNS; c++) { 
                    const cellValue = cells[c].textContent.trim();
                    if (['interval', 'ratio'].includes(columnTypes[c])) {
                        const numValue = Number(cellValue);
                        data[c].push(isNaN(numValue) ? NaN : numValue);
                    } else {
                        data[c].push(cellValue);
                    }
                }
            }
            return data;
        }

        function calculateAllStats() {
            const data = parseTableData();
            summaryResultsBody.innerHTML = '';
            frequencyTablesDiv.innerHTML = '<h3>Tabele Częstości</h3>';
            charts.forEach(chart => chart.destroy());
            charts = []; 
            chartsContainer.innerHTML = ''; 

            data.forEach((colData, colIndex) => { 
                const currentType = columnTypes[colIndex];
                const row = document.createElement('tr');
                
                row.innerHTML = `<td>Kolumna ${colIndex + 1}</td><td>${typeLabels[currentType]}</td>`;

                const isNumeric = ['interval', 'ratio'].includes(currentType);
                const validData = colData.filter(item => isNumeric ? !isNaN(item) : item.trim() !== '');
                const N = validData.length;

                // Obliczenia
                const M = (isNumeric && N > 0) ? mean(validData).toFixed(2) : '-';
                const Me = (isNumeric || currentType === 'ordinal') && N > 0 ? median(validData) : '-';
                const SD = (isNumeric && N > 1) ? stdDev(validData).toFixed(2) : '-';
                const Sk = (isNumeric && N > 2) ? skewness(validData).toFixed(2) : '-';
                const Kurt = (isNumeric && N > 3) ? kurtosis(validData).toFixed(2) : '-';
                
                let Min = '-', Max = '-';
                if(N > 0) {
                    if(isNumeric) {
                        Min = Math.min(...validData).toFixed(2);
                        Max = Math.max(...validData).toFixed(2);
                    } else {
                        const sorted = [...validData].sort();
                        Min = sorted[0];
                        Max = sorted[sorted.length-1];
                    }
                }

                [N, M, Me, SD, Sk, Kurt, Min, Max].forEach(val => {
                    const cell = document.createElement('td');
                    cell.textContent = val;
                    row.appendChild(cell);
                });
                summaryResultsBody.appendChild(row);

                // Tabela częstości
                if (['nominal', 'ordinal'].includes(currentType)) {
                    const counts = {};
                    validData.forEach(x => counts[x] = (counts[x] || 0) + 1);
                    const categories = Object.keys(counts).sort();
                    
                    const freqTable = document.createElement('div');
                    freqTable.className = 'glass-container-inner';
                    freqTable.style.marginBottom = '15px';
                    freqTable.style.background = 'rgba(0,0,0,0.2)'; // Ciemniejsze tło dla tabeli częstości
                    
                    let freqHTML = `<h4 style="text-align:center; color:#fff; margin-bottom:10px;">Kolumna ${colIndex+1}</h4><table style="width:100%"><thead><tr><th>Kategoria</th><th>N</th><th>%</th></tr></thead><tbody>`;
                    
                    categories.forEach(cat => {
                        freqHTML += `<tr><td>${cat}</td><td>${counts[cat]}</td><td>${(counts[cat]/N*100).toFixed(1)}%</td></tr>`;
                    });
                    freqHTML += `</tbody></table>`;
                    freqTable.innerHTML = freqHTML;
                    frequencyTablesDiv.appendChild(freqTable);

                    // Wykres
                    const chartBox = document.createElement('div');
                    chartBox.className = 'chart-box';
                    const canvas = document.createElement('canvas');
                    chartBox.appendChild(canvas);
                    chartsContainer.appendChild(chartBox);
                    
                    charts.push(new Chart(canvas, {
                        type: 'bar',
                        data: {
                            labels: categories,
                            datasets: [{
                                label: `Liczebność`,
                                data: categories.map(c => counts[c]),
                                backgroundColor: 'rgba(54, 162, 235, 0.6)'
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    }));
                }
                
                // Histogram dla liczbowych
                if (isNumeric && N > 0) {
                    const chartBox = document.createElement('div');
                    chartBox.className = 'chart-box';
                    const canvas = document.createElement('canvas');
                    chartBox.appendChild(canvas);
                    chartsContainer.appendChild(chartBox);

                    const minVal = Math.min(...validData);
                    const maxVal = Math.max(...validData);
                    const bins = 10;
                    const step = (maxVal - minVal) / bins;
                    const labels = [], dataBins = new Array(bins).fill(0);

                    for(let i=0; i<bins; i++) {
                        const low = minVal + i*step;
                        const high = low + step;
                        labels.push(`${low.toFixed(0)}-${high.toFixed(0)}`);
                        validData.forEach(v => {
                            if(v >= low && (i===bins-1 ? v <= high : v < high)) dataBins[i]++;
                        });
                    }

                    charts.push(new Chart(canvas, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Histogram',
                                data: dataBins,
                                backgroundColor: 'rgba(255, 159, 64, 0.6)'
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    }));
                }
            });
        }

        function debounce(func, delay) {
            let timeout;
            return function() {
                const context = this, args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeTable();
            calculateAllStats();
        });
    </script>
</body>
</html>